version: '3.8'

services:
  # Servicio del Microservicio Flask
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: users
    # Ya NO necesitamos 'depends_on' ni 'db' si la DB no est√° definida aqu√≠.
    # ELIMINAR depends_on COMPLETAMENTE.
    
    environment:
      # üéØ DB_HOST ahora apunta a tu M√ÅQUINA HOST
      # 'host.docker.internal' es un alias especial para acceder al host desde Docker Desktop.
      DB_HOST: host.docker.internal 
      DB_PORT: 5440
      # üéØ Usar el nombre de la DB que existe en el otro contenedor
      DB_NAME: offer_manager_db 
      DB_USER: postgres
      DB_PASSWORD: postgres
      # La inicializaci√≥n sigue siendo necesaria
      RUN_DB_INIT_ON_STARTUP: "True"
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      AWS_REGION: ${AWS_REGION}
      PYTHONUNBUFFERED: 1
      
    
    ports:
      - "8082:8080"
    
    # El comando se simplifica al no esperar una dependencia interna.
    command: ["sh", "-c", "python app.py"]